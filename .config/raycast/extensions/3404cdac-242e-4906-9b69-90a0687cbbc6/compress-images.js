"use strict";var m=Object.defineProperty;var g=Object.getOwnPropertyDescriptor;var d=Object.getOwnPropertyNames;var h=Object.prototype.hasOwnProperty;var u=(e,t)=>{for(var o in t)m(e,o,{get:t[o],enumerable:!0})},f=(e,t,o,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of d(t))!h.call(e,s)&&s!==o&&m(e,s,{get:()=>t[s],enumerable:!(n=g(t,s))||n.enumerable});return e};var w=e=>f(m({},"__esModule",{value:!0}),e);var I={};u(I,{default:()=>p});module.exports=w(I);var i=require("@raycast/api"),c=require("child_process");var a=require("@raycast/api");async function y(){return(await(0,a.getApplications)()).some(({bundleId:t})=>t==="net.pornel.ImageOptim")}async function r(){let e=await y();if(!e){let t={style:a.Toast.Style.Failure,title:"ImageOptim is not installed.",message:"Install it from: https://imageoptim.com/mac",primaryAction:{title:"Go to https://imageoptim.com/mac",onAction:o=>{(0,a.open)("https://imageoptim.com/mac"),o.hide()}}};await(0,a.showToast)(t)}return e}async function p(){if(console.log("Starting image compression process"),!await r()){console.log("ImageOptim is not installed. Exiting.");return}try{let e=(await(0,i.getSelectedFinderItems)()).map(o=>o.path);if(console.log(`Selected file paths: ${e.join(", ")}`),e.length===0){console.log("No Finder items selected"),await(0,i.showToast)({style:i.Toast.Style.Failure,title:"No Finder items selected",message:"Please select files in Finder and try again"});return}console.log("Showing compression start toast"),await(0,i.showToast)({style:i.Toast.Style.Animated,title:"Compressing with ImageOptim"});let t=e.map(o=>`"${o.replace(/"/g,'\\"')}"`).join(" ");console.log(`Executing ImageOptim with paths: ${t}`),await new Promise((o,n)=>{let s=(0,c.exec)(`/Applications/ImageOptim.app/Contents/MacOS/ImageOptim ${t}`,{shell:"/bin/bash",timeout:3e5});s.on("exit",l=>{l===0?(console.log("ImageOptim process completed successfully"),o(null)):n(new Error(`ImageOptim process exited with code ${l}`))}),s.on("error",l=>{n(l)})}),console.log("Compression completed successfully"),await(0,i.showToast)({style:i.Toast.Style.Success,title:"Compression Complete",message:"Images have been optimized"})}catch(e){console.error("An error occurred:",e),e instanceof Error&&e.message.includes("Finder isn't the frontmost application")?await(0,i.showToast)({style:i.Toast.Style.Failure,title:"Finder is not active",message:"Please switch to Finder and select files"}):await(0,i.showToast)({style:i.Toast.Style.Failure,title:"Operation Failed",message:"An unexpected error occurred"})}}
